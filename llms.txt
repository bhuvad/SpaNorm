# SpaNorm - Spatially-aware normalisation for spatial transcriptomics data

SpaNorm is a spatially aware library size normalisation method that
removes library size effects, while retaining biology. Library sizes
need to be removed from molecular datasets to allow comparisons across
observations, in this case, across space. Bhuva et al. (2024) and Atta
et al. (2023) have shown that standard single-cell inspired library size
normalisation approaches are not appropriate for spatial molecular
datasets as they often remove biological signals while doing so. This is
because library size confounds biology in spatial molecular data.

![The SpaNorm workflow: SpaNorm takes the gene expression data and
spatial coordinates as inputs. Using a gene-wise model (e.g., Negative
Binomial (NB)), SpaNorm decomposes spatially-smooth variation into those
unrelated to library size (LS), representing the underlying true biology
and those related to library size. The adjusted data is then produced by
keeping only the variation unrelated to library
size.](articles/SpaNormWorkflow.png)

*The SpaNorm workflow: SpaNorm takes the gene expression data and
spatial coordinates as inputs. Using a gene-wise model (e.g., Negative
Binomial (NB)), SpaNorm decomposes spatially-smooth variation into those
unrelated to library size (LS), representing the underlying true biology
and those related to library size. The adjusted data is then produced by
keeping only the variation unrelated to library size.*

SpaNorm uses a unique approach to spatially constraint modelling
approach to model gene expression (e.g., counts) and remove library size
effects, while retaining biology. It achieves this through three key
innovations:

1.  Computing spatially smooth functions (using thin plate splines) to
    represent the gene- and location-/cell-/spot- specific size factors.
2.  Optimal decomposition of spatial variation into spatially smooth
    library size associated (technical) and library size independent
    (biology) variation using generalized linear models (GLMs).
3.  Adjustment of data using percentile adjusted counts (PAC) (Salim et
    al., 2022), as well as other adjustment approaches (e.g., Pearson).

## Installation

SpaNorm can be installed from Bioconductor directly as follows:

``` r
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("SpaNorm")
```

The development version can be installed as follows:

``` r
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("bhuvad/SpaNorm")
```

# Package index

## All functions

- [`HumanDLPFC`](https://bhuvad.github.io/spaNorm/reference/HumanDLPFC.md)
  : Human dorsolateral prefrontal cortex (DLPFC) visium sample
- [`SpaNorm()`](https://bhuvad.github.io/spaNorm/reference/SpaNorm.md) :
  Spatially-dependent normalisation for spatial transcriptomics data
- [`` `$`( ``*`<SpaNormFit>`*`)`](https://bhuvad.github.io/spaNorm/reference/SpaNormFit.md)
  : An S4 class to store a SpaNorm model fit
- [`SpaNormPCA()`](https://bhuvad.github.io/spaNorm/reference/SpaNormPCA.md)
  : GLM-based (SpaNorm) PCA
- [`SpaNormSVG()`](https://bhuvad.github.io/spaNorm/reference/SpaNormSVG.md)
  : Model-based spatially variable gene (SVG) calling
- [`fastSizeFactors()`](https://bhuvad.github.io/spaNorm/reference/fastSizeFactors.md)
  : Filter genes based on expression
- [`filterGenes()`](https://bhuvad.github.io/spaNorm/reference/filterGenes.md)
  : Filter genes based on expression
- [`plotCovariate()`](https://bhuvad.github.io/spaNorm/reference/plotCovariate.md)
  : Diagnostic plot of predicted expression for a covariate
- [`plotSpatial()`](https://bhuvad.github.io/spaNorm/reference/plotSpatial.md)
  : Plot spatial transcriptomic annotations per spot
- [`topSVGs()`](https://bhuvad.github.io/spaNorm/reference/topSVGs.md) :
  Export top SVG results to a data frame

# Articles

### All vignettes

- [SpaNorm: Spatially aware library size
  normalisation](https://bhuvad.github.io/spaNorm/articles/SpaNorm.md):
