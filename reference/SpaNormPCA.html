<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>GLM-based (SpaNorm) PCA — SpaNormPCA • SpaNorm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="GLM-based (SpaNorm) PCA — SpaNormPCA"><meta name="description" content="GLM-based PCA using the SpaNorm model. The null model is considered to consist of the library size effects, batch effects, and the gene mean. GLM-PCA is approximated by regressing the null model from the data, and performing PCA on the residuals (Pearson or deviance)."><meta property="og:description" content="GLM-based PCA using the SpaNorm model. The null model is considered to consist of the library size effects, batch effects, and the gene mean. GLM-PCA is approximated by regressing the null model from the data, and performing PCA on the residuals (Pearson or deviance)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpaNorm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/SpaNorm.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bhuvad/SpaNorm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>GLM-based (SpaNorm) PCA</h1>
      <small class="dont-index">Source: <a href="https://github.com/bhuvad/SpaNorm/blob/master/R/mainSpaNormPCA.R" class="external-link"><code>R/mainSpaNormPCA.R</code></a></small>
      <div class="d-none name"><code>SpaNormPCA.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>GLM-based PCA using the SpaNorm model. The null model is considered to consist of the library size effects, batch effects, and the gene mean. GLM-PCA is approximated by regressing the null model from the data, and performing PCA on the residuals (Pearson or deviance).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SpaNormPCA</span><span class="op">(</span></span>
<span>  <span class="va">spe</span>,</span>
<span>  nsvgs <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  ncomponents <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  svg.fdr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  BSPARAM <span class="op">=</span> <span class="fu">bsparam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"deviance"</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"PCA"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'SpatialExperiment'</span></span>
<span><span class="fu">SpaNormPCA</span><span class="op">(</span></span>
<span>  <span class="va">spe</span>,</span>
<span>  nsvgs <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  ncomponents <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  svg.fdr <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  BSPARAM <span class="op">=</span> <span class="fu">bsparam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu">SerialParam</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pearson"</span>, <span class="st">"deviance"</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"PCA"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-spe">spe<a class="anchor" aria-label="anchor" href="#arg-spe"></a></dt>
<dd><p>a SpatialExperiment or Seurat object, with the count data stored in 'counts' or 'data' assays respectively, and a SpaNorm model fit.</p></dd>


<dt id="arg-nsvgs">nsvgs<a class="anchor" aria-label="anchor" href="#arg-nsvgs"></a></dt>
<dd><p>the number of SVGs to use for PCA.</p></dd>


<dt id="arg-ncomponents">ncomponents<a class="anchor" aria-label="anchor" href="#arg-ncomponents"></a></dt>
<dd><p>the number of components to compute.</p></dd>


<dt id="arg-svg-fdr">svg.fdr<a class="anchor" aria-label="anchor" href="#arg-svg-fdr"></a></dt>
<dd><p>the FDR threshold for SVG calling.</p></dd>


<dt id="arg-bsparam">BSPARAM<a class="anchor" aria-label="anchor" href="#arg-bsparam"></a></dt>
<dd><p>a BiocSingularParam object specifying which algorithm should be used to perform the PCA.</p></dd>


<dt id="arg-bpparam">BPPARAM<a class="anchor" aria-label="anchor" href="#arg-bpparam"></a></dt>
<dd><p>a BiocParallelParam object specifying whether the PCA should be parallelized.</p></dd>


<dt id="arg-residuals">residuals<a class="anchor" aria-label="anchor" href="#arg-residuals"></a></dt>
<dd><p>the type of residuals to use for PCA. Either "pearson" (default) or "deviance".</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>the name of the reducedDim to store the PCA results.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a SpatialExperiment or Seurat object with PCA results. For SpatialExperiment objects, these are stored in the reducedDims.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>SpaNorm PCA works by using the SpaNorm model fit for data normalisation to approximate a GLM-based PCA as described in Townes et al. (Genome Biology, 2019). The model used for normalisation represents the library size effects and the gene mean. Regressing these covariates, we remain with the deviance or Pearson residuals, upon which PCA can be performed to approximate the GLM-PCA.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/drighelli/SpatialExperiment" class="external-link">SpatialExperiment</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">HumanDLPFC</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">HumanDLPFC</span> <span class="op">=</span> <span class="fu"><a href="SpaNorm.html">SpaNorm</a></span><span class="op">(</span><span class="va">HumanDLPFC</span>, sample.p <span class="op">=</span> <span class="fl">0.05</span>, df.tps <span class="op">=</span> <span class="fl">2</span>, tol <span class="op">=</span> <span class="fl">1e-2</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (1/2) Fitting SpaNorm model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 201 cells/spots sampled to fit model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, estimating gene-wise dispersion</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, log-likelihood: -1149654.530080</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, fitting NB model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  1, log-likelihood: -1149654.530080</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  2, log-likelihood: -817875.051427</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  3, log-likelihood: -730289.096272</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  4, log-likelihood: -715477.819485</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  5, log-likelihood: -713420.649743</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  6, log-likelihood: -713065.316554</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  7, log-likelihood: -712982.402574</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  8, log-likelihood: -712957.598604 (converged)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, estimating gene-wise dispersion</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, log-likelihood: -712613.990872</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, fitting NB model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  1, log-likelihood: -712613.990872</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  2, log-likelihood: -712457.521967</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  3, log-likelihood: -712448.597511 (converged)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  3, log-likelihood: -712448.597511 (converged)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (2/2) Normalising data</span>
<span class="r-in"><span><span class="va">HumanDLPFC</span> <span class="op">=</span> <span class="fu"><a href="SpaNormSVG.html">SpaNormSVG</a></span><span class="op">(</span><span class="va">HumanDLPFC</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (1/3) Retrieving SpaNorm model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (2/3) Fitting nested SpaNorm model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 201 cells/spots sampled to fit model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, estimating gene-wise dispersion</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, log-likelihood: -1149654.530080</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, fitting NB model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  1, log-likelihood: -1149654.530080</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  2, log-likelihood: -818186.913558</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  3, log-likelihood: -736604.099951</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  4, log-likelihood: -723768.349498</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  5, log-likelihood: -722449.976988</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  1, iter:  6, log-likelihood: -722432.852076 (converged)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, estimating gene-wise dispersion</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, fitting NB model</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  1, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  1, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  1, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  2, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  2, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  2, log-likelihood: -722418.533962</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  2, iter:  3, log-likelihood: -722418.533962 (converged)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> iter:  3, log-likelihood: -722418.533962 (converged)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> (3/3) Finding SVGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 1244 SVGs found (FDR &lt; 0.05)</span>
<span class="r-in"><span><span class="va">HumanDLPFC</span> <span class="op">=</span> <span class="fu">SpaNormPCA</span><span class="op">(</span><span class="va">HumanDLPFC</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDims</a></span><span class="op">(</span><span class="va">HumanDLPFC</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of length 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> names(1): PCA</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dharmesh D. Bhuva, Agus Salim, Ahmed Mohamed.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

